<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Doctor Dashboard - Aarogya Setu</title>
  <style>
    * {margin:0;padding:0;box-sizing:border-box;}
    body {
      font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen,Ubuntu,Cantarell,sans-serif;
      background:#f5f7fa;
      color:#333;
    }

    .header {
      background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
      color:white;
      padding:20px 30px;
      box-shadow:0 2px 10px rgba(0,0,0,0.1);
    }
    .header-content {
      max-width:1400px;
      margin:0 auto;
      display:flex;
      justify-content:space-between;
      align-items:center;
      flex-wrap:wrap;
      gap:15px;
    }
    .header-left {
      display:flex;
      align-items:center;
      gap:15px;
    }
    .logo {
      width:50px;
      height:50px;
      border-radius:10px;
      background:white;
      padding:5px;
      object-fit:contain;
    }
    .header-title h1 {
      font-size:1.5rem;
      font-weight:700;
    }
    .header-title p {
      font-size:0.9rem;
      opacity:0.9;
    }
    .logout-btn {
      background:rgba(255,255,255,0.2);
      color:white;
      border:2px solid white;
      padding:10px 20px;
      border-radius:8px;
      font-weight:600;
      cursor:pointer;
      transition:all .3s;
    }
    .logout-btn:hover {
      background:white;
      color:#667eea;
    }

    .container {
      max-width:1400px;
      margin:30px auto;
      padding:0 20px;
    }

    .welcome-section {
      background:white;
      border-radius:16px;
      padding:30px;
      margin-bottom:30px;
      box-shadow:0 2px 10px rgba(0,0,0,0.08);
    }
    .welcome-section h2 {
      font-size:2rem;
      color:#667eea;
      margin-bottom:10px;
    }
    .doctor-info {
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
      gap:20px;
      margin-top:20px;
    }
    .info-item {
      display:flex;
      flex-direction:column;
    }
    .info-label {
      font-size:0.85rem;
      color:#666;
      margin-bottom:5px;
    }
    .info-value {
      font-size:1.1rem;
      font-weight:600;
      color:#333;
    }

    .stats-grid {
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(250px,1fr));
      gap:20px;
      margin-bottom:30px;
    }
    .stat-card {
      background:white;
      border-radius:12px;
      padding:25px;
      box-shadow:0 2px 10px rgba(0,0,0,0.08);
      transition:transform .3s;
    }
    .stat-card:hover {
      transform:translateY(-5px);
    }
    .stat-icon {
      width:50px;
      height:50px;
      border-radius:10px;
      display:flex;
      align-items:center;
      justify-content:center;
      margin-bottom:15px;
    }
    .stat-icon svg {
      width:28px;
      height:28px;
    }
    .stat-card h3 {
      font-size:0.9rem;
      color:#666;
      margin-bottom:8px;
    }
    .stat-card .stat-value {
      font-size:2rem;
      font-weight:700;
      color:#667eea;
    }

    .section-title {
      font-size:1.5rem;
      font-weight:700;
      margin-bottom:20px;
      color:#333;
    }

    .appointments-section {
      background:white;
      border-radius:16px;
      padding:30px;
      margin-bottom:30px;
      box-shadow:0 2px 10px rgba(0,0,0,0.08);
    }
    .appointments-list {
      margin-top:20px;
    }
    .appointment-item {
      border:2px solid #e0e0e0;
      border-radius:10px;
      padding:20px;
      margin-bottom:15px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      flex-wrap:wrap;
      gap:15px;
    }
    .appointment-info h4 {
      font-size:1.1rem;
      color:#333;
      margin-bottom:5px;
    }
    .appointment-info p {
      font-size:0.9rem;
      color:#666;
    }
    .appointment-actions {
      display:flex;
      gap:10px;
    }
    .btn-small {
      padding:8px 16px;
      border-radius:6px;
      font-size:0.85rem;
      font-weight:600;
      cursor:pointer;
      border:none;
      transition:all .3s;
    }
    .btn-complete {
      background:#4caf50;
      color:white;
    }
    .btn-complete:hover {
      background:#45a049;
    }
    .btn-cancel {
      background:#f44336;
      color:white;
    }
    .btn-cancel:hover {
      background:#da190b;
    }
    .empty-state {
      text-align:center;
      padding:40px;
      color:#999;
    }
    .empty-state svg {
      width:80px;
      height:80px;
      margin-bottom:15px;
      opacity:0.3;
    }

    .patients-section {
      background:white;
      border-radius:16px;
      padding:30px;
      margin-bottom:30px;
      box-shadow:0 2px 10px rgba(0,0,0,0.08);
    }
    .patients-table {
      width:100%;
      border-collapse:collapse;
      margin-top:20px;
    }
    .patients-table th {
      background:#f8f9fa;
      padding:12px;
      text-align:left;
      font-weight:600;
      color:#666;
      border-bottom:2px solid #e0e0e0;
    }
    .patients-table td {
      padding:12px;
      border-bottom:1px solid #e0e0e0;
    }
    .patients-table tr:hover {
      background:#f8f9fa;
    }

    @media (max-width:768px) {
      .header-content {
        flex-direction:column;
        align-items:flex-start;
      }
      .stats-grid {
        grid-template-columns:1fr;
      }
      .appointment-item {
        flex-direction:column;
        align-items:flex-start;
      }
      .patients-table {
        font-size:0.85rem;
      }
    }
  </style>
</head>
<body>

  <header class="header">
    <div class="header-content">
      <div class="header-left">
        <img src="logo.jpeg" alt="Logo" class="logo">
        <div class="header-title">
          <h1>Doctor Dashboard</h1>
          <p id="welcomeText">Welcome back!</p>
        </div>
      </div>
      <button class="logout-btn" onclick="logout()">Logout</button>
    </div>
  </header>

  <div class="container">
    
    <div class="welcome-section">
      <h2 id="doctorName">Welcome, Doctor</h2>
      <div class="doctor-info">
        <div class="info-item">
          <span class="info-label">Doctor ID</span>
          <span class="info-value" id="doctorId">-</span>
        </div>
        <div class="info-item">
          <span class="info-label">Specialization</span>
          <span class="info-value" id="doctorSpecialty">-</span>
        </div>
        <div class="info-item">
          <span class="info-label">Hospital/Clinic</span>
          <span class="info-value" id="doctorHospital">-</span>
        </div>
        <div class="info-item">
          <span class="info-label">Login Time</span>
          <span class="info-value" id="loginTime">-</span>
        </div>
      </div>
    </div>

    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon" style="background:#e3f2fd;">
          <svg fill="none" stroke="#2196f3" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                  d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
          </svg>
        </div>
        <h3>Total Patients</h3>
        <div class="stat-value" id="totalPatients">0</div>
      </div>

      <div class="stat-card">
        <div class="stat-icon" style="background:#e8f5e9;">
          <svg fill="none" stroke="#4caf50" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                  d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
          </svg>
        </div>
        <h3>Today's Appointments</h3>
        <div class="stat-value" id="todayAppointments">0</div>
      </div>

      <div class="stat-card">
        <div class="stat-icon" style="background:#fff3e0;">
          <svg fill="none" stroke="#ff9800" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                  d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
        </div>
        <h3>Pending</h3>
        <div class="stat-value" id="pendingAppointments">0</div>
      </div>

      <div class="stat-card">
        <div class="stat-icon" style="background:#fce4ec;">
          <svg fill="none" stroke="#e91e63" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                  d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
        </div>
        <h3>Completed</h3>
        <div class="stat-value" id="completedAppointments">0</div>
      </div>
    </div>

    <div class="appointments-section">
      <h2 class="section-title">Today's Appointments</h2>
      <div class="appointments-list" id="appointmentsList">
        <div class="empty-state">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                  d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
          </svg>
          <p>No appointments scheduled for today</p>
        </div>
      </div>
    </div>

    <div class="patients-section">
      <h2 class="section-title">Recent Patients</h2>
      <table class="patients-table" id="patientsTable">
        <thead>
          <tr>
            <th>Patient ID</th>
            <th>Name</th>
            <th>Last Visit</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td colspan="4" style="text-align:center;color:#999;padding:40px;">No patient records yet</td>
          </tr>
        </tbody>
      </table>
    </div>

  </div>

  <script>
    // Check if doctor is logged in
    const isLoggedIn = localStorage.getItem('isDoctorLoggedIn');
    if (!isLoggedIn) {
      window.location.href = 'doctor.html';
    }

    // Load doctor data
    const doctorData = JSON.parse(localStorage.getItem('currentDoctor') || '{}');
    
    if (doctorData.name) {
      document.getElementById('doctorName').textContent = `Welcome, Dr. ${doctorData.name}!`;
      document.getElementById('welcomeText').textContent = `Welcome back, Dr. ${doctorData.name}`;
      document.getElementById('doctorId').textContent = doctorData.doctorId || 'N/A';
      document.getElementById('doctorSpecialty').textContent = doctorData.specialty || 'N/A';
      document.getElementById('doctorHospital').textContent = doctorData.hospital || 'N/A';
      
      if (doctorData.loginTime) {
        const loginDate = new Date(doctorData.loginTime);
        document.getElementById('loginTime').textContent = 
          loginDate.toLocaleString('en-IN', { 
            dateStyle: 'medium', 
            timeStyle: 'short' 
          });
      }
    }

    // Load appointments
    function loadAppointments() {
      const appointments = JSON.parse(localStorage.getItem('appointments') || '[]');
      const doctorAppointments = appointments.filter(apt => 
        apt.doctorId === doctorData.doctorId
      );

      // Get today's date
      const today = new Date().toISOString().split('T')[0];
      const todayAppointments = doctorAppointments.filter(apt => apt.date === today);

      // Update stats
      const uniquePatients = new Set(doctorAppointments.map(apt => apt.patientId));
      document.getElementById('totalPatients').textContent = uniquePatients.size;
      document.getElementById('todayAppointments').textContent = todayAppointments.length;
      
      const pending = doctorAppointments.filter(apt => apt.status === 'upcoming').length;
      const completed = doctorAppointments.filter(apt => apt.status === 'completed').length;
      document.getElementById('pendingAppointments').textContent = pending;
      document.getElementById('completedAppointments').textContent = completed;

      // Display today's appointments
      const appointmentsList = document.getElementById('appointmentsList');
      if (todayAppointments.length > 0) {
        appointmentsList.innerHTML = todayAppointments.map((apt, index) => `
          <div class="appointment-item">
            <div class="appointment-info">
              <h4>${apt.patientName}</h4>
              <p>Patient ID: ${apt.patientId} â€¢ ${apt.time}</p>
              <p style="margin-top:5px;font-size:0.85rem;color:#999;">${apt.reason || 'General Consultation'}</p>
            </div>
            <div class="appointment-actions">
              <button class="btn-small btn-complete" onclick="completeAppointment(${index})">Complete</button>
              <button class="btn-small btn-cancel" onclick="cancelAppointment(${index})">Cancel</button>
            </div>
          </div>
        `).join('');
      }

      // Load recent patients
      loadRecentPatients(doctorAppointments);
    }

    function loadRecentPatients(appointments) {
      if (appointments.length === 0) return;

      const recentAppointments = appointments
        .sort((a, b) => new Date(b.date) - new Date(a.date))
        .slice(0, 10);

      const tbody = document.querySelector('.patients-table tbody');
      tbody.innerHTML = recentAppointments.map(apt => `
        <tr>
          <td>${apt.patientId}</td>
          <td>${apt.patientName}</td>
          <td>${apt.date}</td>
          <td><span style="color:${apt.status === 'completed' ? '#4caf50' : '#ff9800'};font-weight:600;">${apt.status.toUpperCase()}</span></td>
        </tr>
      `).join('');
    }

    function completeAppointment(index) {
      const appointments = JSON.parse(localStorage.getItem('appointments') || '[]');
      const today = new Date().toISOString().split('T')[0];
      const todayAppointments = appointments.filter(apt => 
        apt.doctorId === doctorData.doctorId && apt.date === today
      );
      
      if (todayAppointments[index]) {
        const aptIndex = appointments.findIndex(apt => 
          apt.patientId === todayAppointments[index].patientId && 
          apt.date === todayAppointments[index].date &&
          apt.time === todayAppointments[index].time
        );
        
        if (aptIndex !== -1) {
          appointments[aptIndex].status = 'completed';
          localStorage.setItem('appointments', JSON.stringify(appointments));
          alert('Appointment marked as completed!');
          loadAppointments();
        }
      }
    }

    function cancelAppointment(index) {
      if (!confirm('Are you sure you want to cancel this appointment?')) return;
      
      const appointments = JSON.parse(localStorage.getItem('appointments') || '[]');
      const today = new Date().toISOString().split('T')[0];
      const todayAppointments = appointments.filter(apt => 
        apt.doctorId === doctorData.doctorId && apt.date === today
      );
      
      if (todayAppointments[index]) {
        const aptIndex = appointments.findIndex(apt => 
          apt.patientId === todayAppointments[index].patientId && 
          apt.date === todayAppointments[index].date &&
          apt.time === todayAppointments[index].time
        );
        
        if (aptIndex !== -1) {
          appointments.splice(aptIndex, 1);
          localStorage.setItem('appointments', JSON.stringify(appointments));
          alert('Appointment cancelled!');
          loadAppointments();
        }
      }
    }

    loadAppointments();

    function logout() {
      if (confirm('Are you sure you want to logout?')) {
        localStorage.removeItem('isDoctorLoggedIn');
        localStorage.removeItem('currentDoctor');
        window.location.href = 'doctor.html';
      }
    }
  </script>
</body>
</html>
