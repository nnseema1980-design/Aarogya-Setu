<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Book Appointment - Aarogya Setu</title>
  <style>
    * {margin:0;padding:0;box-sizing:border-box;}
    body {
      font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen,Ubuntu,Cantarell,sans-serif;
      background:linear-gradient(135deg,#17a2b8 0%,#138496 100%);
      min-height:100vh;
      color:#333;
    }

    .header {
      background:rgba(255,255,255,0.1);
      backdrop-filter:blur(10px);
      padding:20px 30px;
      color:white;
    }
    .header-content {
      max-width:1200px;
      margin:0 auto;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    .header h1 {
      font-size:1.5rem;
    }
    .back-btn {
      background:white;
      color:#17a2b8;
      border:none;
      padding:10px 20px;
      border-radius:8px;
      font-weight:600;
      cursor:pointer;
      transition:all .3s;
    }
    .back-btn:hover {
      transform:translateY(-2px);
      box-shadow:0 5px 15px rgba(255,255,255,0.3);
    }

    .container {
      max-width:1200px;
      margin:40px auto;
      padding:0 20px;
    }

    .booking-grid {
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:30px;
    }

    .doctors-section {
      background:white;
      border-radius:16px;
      padding:30px;
      box-shadow:0 10px 40px rgba(0,0,0,0.2);
      max-height:80vh;
      overflow-y:auto;
    }
    .doctors-section h2 {
      font-size:1.8rem;
      margin-bottom:20px;
      color:#17a2b8;
    }

    .search-box {
      margin-bottom:20px;
    }
    .search-box input {
      width:100%;
      padding:12px 16px;
      border:2px solid #e0e0e0;
      border-radius:8px;
      font-size:15px;
      outline:none;
    }
    .search-box input:focus {
      border-color:#17a2b8;
    }

    .filter-group {
      display:flex;
      gap:10px;
      margin-bottom:20px;
      flex-wrap:wrap;
    }
    .filter-btn {
      padding:8px 16px;
      border:2px solid #e0e0e0;
      background:white;
      border-radius:20px;
      cursor:pointer;
      font-size:0.9rem;
      transition:all .3s;
    }
    .filter-btn:hover, .filter-btn.active {
      background:#17a2b8;
      color:white;
      border-color:#17a2b8;
    }

    .doctor-card {
      border:2px solid #e0e0e0;
      border-radius:12px;
      padding:20px;
      margin-bottom:15px;
      cursor:pointer;
      transition:all .3s;
    }
    .doctor-card:hover {
      border-color:#17a2b8;
      box-shadow:0 5px 15px rgba(23,162,184,0.2);
    }
    .doctor-card.selected {
      border-color:#17a2b8;
      background:#e6f7f9;
    }
    .doctor-header {
      display:flex;
      justify-content:space-between;
      align-items:start;
      margin-bottom:10px;
    }
    .doctor-name {
      font-size:1.2rem;
      font-weight:700;
      color:#333;
    }
    .doctor-specialty {
      color:#17a2b8;
      font-weight:600;
      margin-bottom:5px;
    }
    .doctor-details {
      font-size:0.9rem;
      color:#666;
      line-height:1.6;
    }
    .doctor-fee {
      display:inline-block;
      background:#e6f7f9;
      color:#17a2b8;
      padding:6px 12px;
      border-radius:6px;
      font-weight:600;
      font-size:0.9rem;
    }

    .booking-form-section {
      background:white;
      border-radius:16px;
      padding:30px;
      box-shadow:0 10px 40px rgba(0,0,0,0.2);
    }
    .booking-form-section h2 {
      font-size:1.8rem;
      margin-bottom:20px;
      color:#17a2b8;
    }

    .form-group {
      margin-bottom:20px;
    }
    .form-group label {
      display:block;
      margin-bottom:8px;
      color:#333;
      font-weight:600;
      font-size:14px;
    }
    .form-group input, .form-group select, .form-group textarea {
      width:100%;
      padding:12px 16px;
      border:2px solid #e0e0e0;
      border-radius:8px;
      font-size:15px;
      outline:none;
      font-family:inherit;
    }
    .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
      border-color:#17a2b8;
      box-shadow:0 0 0 3px rgba(23,162,184,0.1);
    }
    .form-group textarea {
      resize:vertical;
      min-height:80px;
    }

    .selected-doctor-info {
      background:#e6f7f9;
      padding:15px;
      border-radius:8px;
      margin-bottom:20px;
      display:none;
    }
    .selected-doctor-info.show {
      display:block;
    }
    .selected-doctor-info h4 {
      color:#17a2b8;
      margin-bottom:5px;
    }

    .time-slots {
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(100px,1fr));
      gap:10px;
      margin-top:10px;
    }
    .time-slot {
      padding:10px;
      border:2px solid #e0e0e0;
      border-radius:8px;
      text-align:center;
      cursor:pointer;
      transition:all .3s;
      font-size:0.9rem;
    }
    .time-slot:hover {
      border-color:#17a2b8;
      background:#e6f7f9;
    }
    .time-slot.selected {
      background:#17a2b8;
      color:white;
      border-color:#17a2b8;
    }

    .submit-btn {
      width:100%;
      padding:15px;
      background:#17a2b8;
      color:white;
      border:none;
      border-radius:8px;
      font-size:16px;
      font-weight:600;
      cursor:pointer;
      transition:all .3s;
      margin-top:10px;
    }
    .submit-btn:hover {
      background:#138496;
      transform:translateY(-2px);
      box-shadow:0 5px 15px rgba(23,162,184,0.3);
    }
    .submit-btn:disabled {
      background:#ccc;
      cursor:not-allowed;
      transform:none;
    }

    .empty-state {
      text-align:center;
      padding:40px;
      color:#999;
    }

    @media (max-width:968px) {
      .booking-grid {
        grid-template-columns:1fr;
      }
      .doctors-section {
        max-height:none;
      }
    }
  </style>
</head>
<body>

  <header class="header">
    <div class="header-content">
      <h1>Book Appointment</h1>
      <button class="back-btn" onclick="window.location.href='patient-dashboard.html'">Back to Dashboard</button>
    </div>
  </header>

  <div class="container">
    <div class="booking-grid">
      
      <!-- Doctors List -->
      <div class="doctors-section">
        <h2>Select a Doctor</h2>
        
        <div class="search-box">
          <input type="text" id="searchInput" placeholder="Search by name or specialty...">
        </div>

        <div class="filter-group">
          <button class="filter-btn active" data-filter="all">All</button>
          <button class="filter-btn" data-filter="Cardiologist">Cardiologist</button>
          <button class="filter-btn" data-filter="Dermatologist">Dermatologist</button>
          <button class="filter-btn" data-filter="Neurologist">Neurologist</button>
          <button class="filter-btn" data-filter="Pediatrician">Pediatrician</button>
          <button class="filter-btn" data-filter="Orthopedic">Orthopedic</button>
        </div>

        <div id="doctorsList">
          <div class="empty-state">No doctors available. Please register doctors first.</div>
        </div>
      </div>

      <!-- Booking Form -->
      <div class="booking-form-section">
        <h2>Appointment Details</h2>

        <div class="selected-doctor-info" id="selectedDoctorInfo">
          <h4>Selected Doctor</h4>
          <p id="selectedDoctorName">-</p>
        </div>

        <form id="bookingForm">
          <div class="form-group">
            <label for="appointmentDate">Appointment Date *</label>
            <input type="date" id="appointmentDate" required>
          </div>

          <div class="form-group">
            <label>Select Time Slot *</label>
            <div class="time-slots" id="timeSlots">
              <div class="time-slot" data-time="09:00">09:00 AM</div>
              <div class="time-slot" data-time="10:00">10:00 AM</div>
              <div class="time-slot" data-time="11:00">11:00 AM</div>
              <div class="time-slot" data-time="12:00">12:00 PM</div>
              <div class="time-slot" data-time="14:00">02:00 PM</div>
              <div class="time-slot" data-time="15:00">03:00 PM</div>
              <div class="time-slot" data-time="16:00">04:00 PM</div>
              <div class="time-slot" data-time="17:00">05:00 PM</div>
            </div>
          </div>

          <div class="form-group">
            <label for="reason">Reason for Visit *</label>
            <textarea id="reason" placeholder="Describe your symptoms or reason for consultation" required></textarea>
          </div>

          <div class="form-group">
            <label for="notes">Additional Notes</label>
            <textarea id="notes" placeholder="Any additional information (optional)"></textarea>
          </div>

          <button type="submit" class="submit-btn" id="submitBtn" disabled>Book Appointment</button>
        </form>
      </div>

    </div>
  </div>

  <script>
    // Check if patient is logged in
    const isLoggedIn = localStorage.getItem('isPatientLoggedIn');
    if (!isLoggedIn) {
      alert('Please login first!');
      window.location.href = 'patient.html';
    }

    const patientData = JSON.parse(localStorage.getItem('currentPatient') || '{}');
    let selectedDoctor = null;
    let selectedTime = null;

    // Set minimum date to today
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('appointmentDate').min = today;

    // Load doctors
    function loadDoctors(filter = 'all', search = '') {
      const doctors = JSON.parse(localStorage.getItem('doctors') || '[]');
      const doctorsList = document.getElementById('doctorsList');

      let filteredDoctors = doctors;

      // Apply specialty filter
      if (filter !== 'all') {
        filteredDoctors = filteredDoctors.filter(d => d.specialty === filter);
      }

      // Apply search filter
      if (search) {
        filteredDoctors = filteredDoctors.filter(d => 
          d.firstName.toLowerCase().includes(search.toLowerCase()) ||
          d.lastName.toLowerCase().includes(search.toLowerCase()) ||
          d.specialty.toLowerCase().includes(search.toLowerCase())
        );
      }

      if (filteredDoctors.length === 0) {
        doctorsList.innerHTML = '<div class="empty-state">No doctors found matching your criteria.</div>';
        return;
      }

      doctorsList.innerHTML = filteredDoctors.map(doctor => `
        <div class="doctor-card" data-doctor-id="${doctor.doctorId}">
          <div class="doctor-header">
            <div>
              <div class="doctor-name">Dr. ${doctor.firstName} ${doctor.lastName}</div>
              <div class="doctor-specialty">${doctor.specialty}</div>
            </div>
            <div class="doctor-fee">â‚¹${doctor.consultationFee}</div>
          </div>
          <div class="doctor-details">
            <p><strong>Experience:</strong> ${doctor.experience} years</p>
            <p><strong>Qualification:</strong> ${doctor.qualification}</p>
            <p><strong>Hospital:</strong> ${doctor.hospital}</p>
            ${doctor.bio ? `<p style="margin-top:8px;">${doctor.bio}</p>` : ''}
          </div>
        </div>
      `).join('');

      // Add click handlers
      document.querySelectorAll('.doctor-card').forEach(card => {
        card.addEventListener('click', function() {
          document.querySelectorAll('.doctor-card').forEach(c => c.classList.remove('selected'));
          this.classList.add('selected');
          
          const doctorId = this.dataset.doctorId;
          selectedDoctor = doctors.find(d => d.doctorId === doctorId);
          
          document.getElementById('selectedDoctorInfo').classList.add('show');
          document.getElementById('selectedDoctorName').textContent = 
            `Dr. ${selectedDoctor.firstName} ${selectedDoctor.lastName} - ${selectedDoctor.specialty}`;
          
          updateSubmitButton();
        });
      });
    }

    // Filter buttons
    document.querySelectorAll('.filter-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        loadDoctors(this.dataset.filter, document.getElementById('searchInput').value);
      });
    });

    // Search
    document.getElementById('searchInput').addEventListener('input', function() {
      const activeFilter = document.querySelector('.filter-btn.active').dataset.filter;
      loadDoctors(activeFilter, this.value);
    });

    // Time slot selection
    document.querySelectorAll('.time-slot').forEach(slot => {
      slot.addEventListener('click', function() {
        document.querySelectorAll('.time-slot').forEach(s => s.classList.remove('selected'));
        this.classList.add('selected');
        selectedTime = this.dataset.time;
        updateSubmitButton();
      });
    });

    function updateSubmitButton() {
      const date = document.getElementById('appointmentDate').value;
      const reason = document.getElementById('reason').value.trim();
      const submitBtn = document.getElementById('submitBtn');
      
      if (selectedDoctor && selectedTime && date && reason) {
        submitBtn.disabled = false;
      } else {
        submitBtn.disabled = true;
      }
    }

    // Form validation
    document.getElementById('appointmentDate').addEventListener('change', updateSubmitButton);
    document.getElementById('reason').addEventListener('input', updateSubmitButton);

    // Form submission
    document.getElementById('bookingForm').addEventListener('submit', function(e) {
      e.preventDefault();

      if (!selectedDoctor || !selectedTime) {
        alert('Please select a doctor and time slot!');
        return;
      }

      const appointmentData = {
        appointmentId: 'APT' + Date.now(),
        patientId: patientData.uniqueId,
        patientName: patientData.name,
        doctorId: selectedDoctor.doctorId,
        doctorName: `${selectedDoctor.firstName} ${selectedDoctor.lastName}`,
        specialty: selectedDoctor.specialty,
        date: document.getElementById('appointmentDate').value,
        time: selectedTime,
        reason: document.getElementById('reason').value.trim(),
        notes: document.getElementById('notes').value.trim(),
        status: 'upcoming',
        bookedAt: new Date().toISOString()
      };

      // Save appointment
      let appointments = JSON.parse(localStorage.getItem('appointments') || '[]');
      appointments.push(appointmentData);
      localStorage.setItem('appointments', JSON.stringify(appointments));

      alert(`Appointment booked successfully!\n\nDoctor: Dr. ${selectedDoctor.firstName} ${selectedDoctor.lastName}\nDate: ${appointmentData.date}\nTime: ${selectedTime}\n\nYour Appointment ID: ${appointmentData.appointmentId}`);
      
      window.location.href = 'patient-dashboard.html';
    });

    // Initial load
    loadDoctors();
  </script>
</body>
</html>
